services:
  clickhouse:
    image: clickhouse/clickhouse-server:24.8
    ports: ["8123:8123", "9000:9000"]
    environment:
      CLICKHOUSE_DB: metric_ops
    volumes:
      - ./db/schema.sql:/docker-entrypoint-initdb.d/01-schema.sql
  backend:
    build: ./backend
    environment:
      CLICKHOUSE_URL: http://clickhouse:8123
      CLICKHOUSE_DB: metric_ops
      JWT_SECRET: dev-secret
    depends_on: [clickhouse]
    ports: ["3000:3000"]
    volumes:
      - ./backend/src:/app/src
  frontend:
    build: ./frontend
    depends_on: [backend]
    ports: ["5173:5173"]
    volumes:
      - ./frontend/src:/app/src
